<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Appointments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <script src="../js/auth.js" defer></script>
</head>
<body>

<nav class="navbar navbar-expand-lg bg-light shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">HMS</a>
    <div class="navbar-nav ms-auto">
      <a class="nav-link active" href="my-appointments.html">My Appointments</a>
      <a class="nav-link" href="user-profile.html">My Profile</a>
      <button id="logout-button" class="btn btn-outline-danger ms-2">Logout</button>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center">
    <h1>My Appointments</h1>
    <a href="book-appointment.html" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Book New Appointment</a>
  </div>
  <hr>
  <table class="table table-hover">
    <thead class="table-light">
    <tr><th>ID</th><th>Doctor</th><th>Branch</th><th>Date & Time</th><th>Status</th></tr>
    </thead>
    <tbody id="appointments-table-body">
    </tbody>
  </table>
</div>

<script>
  const token = localStorage.getItem('authToken');

  // Fetch and display appointments when the page loads
  document.addEventListener('DOMContentLoaded', function() {
    fetch('http://localhost:8080/api/user/my-appointments', {
      headers: { 'Authorization': 'Bearer ' + token }
    })
            .then(res => res.json())
            .then(appointments => {
              const tbody = document.getElementById('appointments-table-body');
              tbody.innerHTML = '';
              if (appointments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">You have no appointments.</td></tr>';
              } else {
                appointments.forEach(app => {
                  tbody.innerHTML += `
                            <tr>
                                <td>#${app.id}</td>
                                <td>${app.doctorName}</td>
                                <td>${app.branchName}</td>
                                <td>${new Date(app.appointmentDate).toLocaleString()}</td>
                                <td><span class="badge bg-success">${app.status}</span></td>
                            </tr>
                        `;
                });
              }
            })
            .catch(error => {
              console.error("Error fetching appointments:", error);
              document.getElementById('appointments-table-body').innerHTML = '<tr><td colspan="5" class="text-center text-danger">Could not load appointments.</td></tr>';
            });
  });

  // Handle Logout
  document.getElementById('logout-button').addEventListener('click', () => {
    localStorage.removeItem('authToken');
    window.location.href = 'login.html';
  });
</script>

</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="en" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>My Appointments - HMS</title>-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">-->
<!--</head>-->
<!--<body style="background-color: #f8f9fa;">-->

<!--<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">-->
<!--  <div class="container">-->
<!--    <a class="navbar-brand fw-bold" th:href="@{/}"><i class="bi bi-hospital"></i> HMS</a>-->
<!--    <div class="collapse navbar-collapse">-->
<!--      <ul class="navbar-nav ms-auto">-->
<!--&lt;!&ndash;        <li class="nav-item"><a class="nav-link active" th:href="@{/my-appointments}">My Appointments</a></li>&ndash;&gt;-->
<!--        <li class="nav-item"><a class="nav-link active" href="my-appointments.html">My Appointments</a></li>-->
<!--&lt;!&ndash;        <li class="nav-item"><a class="nav-link" th:href="@{/profile}">My Profile</a></li>&ndash;&gt;-->
<!--        <li class="nav-item"><a class="nav-link" href="user-profile.html">My Profile</a></li>-->
<!--&lt;!&ndash;        <li class="nav-item"><a class="nav-link active" th:href="@{/ai-assistant}">AI Assistant</a></li>&ndash;&gt;-->
<!--        <li class="nav-item"><a class="nav-link active" href="ai-health-assistant.html">AI Assistant</a></li>-->

<!--        <li class="nav-item"><a class="btn btn-outline-danger" th:href="@{/logout}">Logout</a></li>-->
<!--      </ul>-->
<!--    </div>-->
<!--  </div>-->
<!--</nav>-->

<!--<div class="container mt-5">-->
<!--  <div class="d-flex justify-content-between align-items-center">-->
<!--    <h1 class="mt-4">My Appointments</h1>-->
<!--&lt;!&ndash;    <a th:href="@{/appointments/new}" class="btn btn-primary btn-lg">&ndash;&gt;-->
<!--    <a href="publicAppoiment.html" class="btn btn-primary btn-lg">-->
<!--      <i class="bi bi-plus-circle"></i> Book New Appointment-->
<!--    </a>-->
<!--  </div>-->
<!--  <hr>-->

<!--  <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>-->

<!--  <div class="card shadow-sm">-->
<!--    <div class="card-header">-->
<!--      Your Appointment History-->
<!--    </div>-->
<!--    <div class="card-body">-->
<!--      <table class="table table-hover align-middle">-->
<!--        <thead class="table-light">-->
<!--        <tr>-->
<!--          <th>Appointment ID</th>-->
<!--          <th>Doctor</th>-->
<!--          <th>Branch</th>-->
<!--          <th>Date & Time</th>-->
<!--          <th>Status</th>-->
<!--          <th>Actions</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr th:each="app : ${appointmentList}">-->
<!--          <td th:text="'#' + ${app.id}">#1025</td>-->
<!--          <td th:text="${app.doctor.firstName} + ' ' + ${app.doctor.lastName}">Dr. Kamal Perera</td>-->
<!--          <td th:text="${app.branch.name}">Colombo Branch</td>-->
<!--          <td th:text="${#temporals.format(app.appointmentDate, 'yyyy-MM-dd HH:mm')}">2025-07-20 10:30</td>-->
<!--          <td>-->
<!--                        <span class="badge"-->
<!--                              th:text="${app.status}"-->
<!--                              th:classappend="${-->
<!--                                  app.status == 'CONFIRMED' ? 'bg-success' :-->
<!--                                  (app.status == 'COMPLETED' ? 'bg-secondary' :-->
<!--                                  (app.status == 'PENDING_PAYMENT' ? 'bg-warning text-dark' : 'bg-danger'))-->
<!--                              }">-->
<!--                            CONFIRMED-->
<!--                        </span>-->
<!--          </td>-->
<!--          <td>-->
<!--            <a th:if="${app.status == 'CONFIRMED' or app.status == 'PENDING_PAYMENT'}"-->
<!--               href="#" class="btn btn-sm btn-danger">Cancel</a>-->

<!--            <a th:if="${app.status == 'COMPLETED'}"-->
<!--               href="#" class="btn btn-sm btn-info">View Receipt</a>-->
<!--          </td>-->
<!--        </tr>-->
<!--        <tr>-->
<!--          <td>#1022</td>-->
<!--          <td>Dr. Nimali Alwis</td>-->
<!--          <td>Kandy Branch</td>-->
<!--          <td>2025-06-15 09:00</td>-->
<!--          <td><span class="badge bg-secondary">COMPLETED</span></td>-->
<!--          <td><a href="#" class="btn btn-sm btn-info">View Receipt</a></td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--      </table>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!--</body>-->
<!--</html>-->