<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Branches</title>
</head>
<body>
<div id="sidebar-placeholder"></div>

<div class="content">
  <div class="d-flex justify-content-between align-items-center">
    <h1>Manage Branches</h1>
    <a href="add-branch.html" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Add New Branch</a>
  </div>
  <hr>

  <div id="branch-list-container" class="row">
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/layout-loader.js"></script> <script>
  document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('authToken');
    const container = document.getElementById('branch-list-container');

    fetch('http://localhost:8080/api/branches/details', { headers: { 'Authorization': 'Bearer ' + token } })
            .then(res => res.json())
            .then(branches => {
              container.innerHTML = ''; // Clear loading state
              if (branches.length === 0) {
                container.innerHTML = '<p>No branches found. Please add a new branch.</p>';
                return;
              }
              branches.forEach(branch => {
                container.innerHTML += `
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="card-title mb-0">${branch.name}</h5>
                                    <small class="text-muted"><i class="bi bi-geo-alt"></i> ${branch.location}</small>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item d-flex justify-content-between">Patients<span class="badge bg-primary rounded-pill">${branch.patientCount}</span></li>
                                        <li class="list-group-item d-flex justify-content-between">Doctors<span class="badge bg-info rounded-pill">${branch.doctorCount}</span></li>
                                        <li class="list-group-item d-flex justify-content-between">App. Today<span class="badge bg-success rounded-pill">${branch.appointmentsTodayCount}</span></li>
                                    </ul>
                                </div>
                                <div class="card-footer text-center">
                                    <a href="#" class="btn btn-dark w-100"><i class="bi bi-sliders"></i> Manage Branch</a>
                                </div>
                            </div>
                        </div>
                    `;
              });
            })
            .catch(error => {
              console.error("Error loading branches:", error);
              container.innerHTML = '<p class="text-danger">Failed to load branch details.</p>';
            });
  });
</script>
</body>
</html>