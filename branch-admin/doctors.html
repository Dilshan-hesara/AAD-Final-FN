<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <title>Manage Doctors</title>-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">-->
<!--  <link rel="stylesheet" href="../css/styles.css">-->
<!--  <script src="../js/auth.js" defer></script>-->
<!--</head>-->
<!--<body>-->
<!--<div id="sidebar-placeholder"></div>-->

<!--<div class="content">-->
<!--  <h1>Manage Doctors</h1><hr>-->
<!--  <div class="card bg-light mb-4">-->
<!--    <div class="card-body"><div class="row g-3">-->
<!--      <div class="col-md-5"><label>Search by Name</label><input type="text" id="nameFilter" class="form-control"></div>-->
<!--      <div class="col-md-5"><label>Filter by Specialization</label><input type="text" id="specFilter" class="form-control"></div>-->
<!--      <div class="col-md-2 d-flex align-items-end"><button id="filter-btn" class="btn btn-primary w-100">Search</button></div>-->
<!--    </div></div>-->
<!--  </div>-->

<!--  <div class="d-flex justify-content-between align-items-center mb-3">-->
<!--    <span id="result-summary"></span>-->
<!--    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addDoctorModal"><i class="bi bi-plus-circle"></i> Add New Doctor</button>-->
<!--  </div>-->
<!--  <div class="card"><div class="table-responsive">-->
<!--    <table class="table table-hover mb-0">-->
<!--      <thead class="table-light"><tr><th>Name</th><th>Specialization</th><th>Status</th><th>Actions</th></tr></thead>-->
<!--      <tbody id="doctor-table-body"></tbody>-->
<!--    </table>-->
<!--  </div></div>-->
<!--  <nav class="mt-4"><ul id="pagination" class="pagination justify-content-center"></ul></nav>-->
<!--</div>-->

<!--<div class="modal fade" id="editDoctorModal" tabindex="-1">-->
<!--  <div class="modal-dialog"><div class="modal-content">-->
<!--    <div class="modal-header"><h5 class="modal-title">Edit Doctor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>-->
<!--    <div class="modal-body">-->
<!--      <form id="edit-doctor-form">-->
<!--        <input type="hidden" id="editDoctorId">-->
<!--        <div class="mb-3"><label class="form-label">Full Name</label><input type="text" id="editFullName" class="form-control" required></div>-->
<!--        <div class="mb-3"><label class="form-label">Specialization</label><input type="text" id="editSpecialization" class="form-control" required></div>-->
<!--        <div class="mb-3"><label class="form-label">Contact Number</label><input type="text" id="editContactNumber" class="form-control"></div>-->
<!--        <div class="mb-3"><label class="form-label">Email</label><input type="email" id="editEmail" class="form-control"></div>-->
<!--      </form>-->
<!--    </div>-->
<!--    <div class="modal-footer">-->
<!--      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--      <button type="submit" form="edit-doctor-form" class="btn btn-primary">Save Changes</button>-->
<!--    </div>-->
<!--  </div></div>-->
<!--</div>-->

<!--<div class="modal fade" id="addDoctorModal" tabindex="-1">-->
<!--  <div class="modal-dialog"><div class="modal-content">-->
<!--    <div class="modal-header"><h5 class="modal-title">Add New Doctor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>-->
<!--    <div class="modal-body">-->
<!--      <form id="add-doctor-form">-->
<!--        <div class="mb-3"><label class="form-label">Full Name</label><input type="text" id="addFullName" class="form-control" required></div>-->
<!--        <div class="mb-3"><label class="form-label">Specialization</label><input type="text" id="addSpecialization" class="form-control" required></div>-->
<!--        <div class="mb-3"><label class="form-label">Contact Number</label><input type="text" id="addContactNumber" class="form-control"></div>-->
<!--        <div class="mb-3"><label class="form-label">Email</label><input type="email" id="addEmail" class="form-control"></div>-->
<!--      </form>-->
<!--    </div>-->
<!--    <div class="modal-footer">-->
<!--      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--      <button type="submit" form="add-doctor-form" class="btn btn-primary">Save Doctor</button>-->
<!--    </div>-->
<!--  </div></div>-->

<!--  -->
<!--</div>-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>-->
<!--<script src="../js/layout-loader.js"></script>-->
<!--<script>-->
<!--  const token = localStorage.getItem('authToken');-->
<!--  let currentPage = 0;-->
<!--  const editModal = new bootstrap.Modal(document.getElementById('editDoctorModal'));-->
<!--  const addModal = new bootstrap.Modal(document.getElementById('addDoctorModal'));-->

<!--  function loadDoctors(page = 0) {-->
<!--    currentPage = page;-->
<!--    const name = document.getElementById('nameFilter').value;-->
<!--    const spec = document.getElementById('specFilter').value;-->
<!--    let url = `http://localhost:8080/api/doctors?page=${page}&size=5&sort=fullName,asc`;-->
<!--    if (name) url += `&name=${name}`;-->
<!--    if (spec) url += `&specialization=${spec}`;-->
<!--    fetch(url, { headers: { 'Authorization': 'Bearer ' + token } }).then(res => res.json()).then(pageData => {-->
<!--      renderTable(pageData.content);-->
<!--      renderPagination(pageData);-->
<!--      document.getElementById('result-summary').textContent = `Showing ${pageData.numberOfElements} of ${pageData.totalElements} results.`;-->
<!--    });-->
<!--  }-->

<!--  function renderTable(doctors) {-->
<!--    const tableBody = document.getElementById('doctor-table-body');-->
<!--    tableBody.innerHTML = '';-->
<!--    doctors.forEach(doc => {-->
<!--      const actionButton = doc.status === 'ACTIVE'-->
<!--              ? `<button class="btn btn-danger btn-sm action-btn" data-action="deactivate" data-id="${doc.id}">Deactivate</button>`-->
<!--              : `<button class="btn btn-success btn-sm action-btn" data-action="activate" data-id="${doc.id}">Activate</button>`;-->
<!--      tableBody.innerHTML += `<tr><td>${doc.fullName}</td><td>${doc.specialization}</td><td><span class="badge bg-${doc.status === 'ACTIVE' ? 'success' : 'secondary'}">${doc.status}</span></td><td><button class="btn btn-primary btn-sm edit-btn" data-id="${doc.id}" data-name="${doc.fullName}" data-spec="${doc.specialization}" data-contact="${doc.contactNumber || ''}" data-email="${doc.email || ''}">Edit</button> ${actionButton}</td></tr>`;-->
<!--    });-->
<!--    attachRowEventListeners();-->
<!--  }-->

<!--  function attachRowEventListeners() {-->
<!--    document.querySelectorAll('.edit-btn').forEach(btn => {-->
<!--      btn.addEventListener('click', function() {-->
<!--        document.getElementById('editDoctorId').value = this.dataset.id;-->
<!--        document.getElementById('editFullName').value = this.dataset.name;-->
<!--        document.getElementById('editSpecialization').value = this.dataset.spec;-->
<!--        document.getElementById('editContactNumber').value = this.dataset.contact;-->
<!--        document.getElementById('editEmail').value = this.dataset.email;-->
<!--        editModal.show();-->
<!--      });-->
<!--    });-->
<!--    document.querySelectorAll('.action-btn').forEach(btn => {-->
<!--      btn.addEventListener('click', function() {-->
<!--        updateDoctorStatus(this.dataset.id, this.dataset.action);-->
<!--      });-->
<!--    });-->
<!--  }-->

<!--  function updateDoctorStatus(id, action) {-->
<!--    if (!confirm(`Are you sure you want to ${action} this doctor?`)) return;-->
<!--    fetch(`http://localhost:8080/api/doctors/${id}/${action}`, {-->
<!--      method: 'PATCH',-->
<!--      headers: { 'Authorization': 'Bearer ' + token },-->
<!--    }).then(response => {-->
<!--      if (response.ok) { loadDoctors(currentPage); }-->
<!--      else { alert('Error updating status.'); }-->
<!--    });-->
<!--  }-->

<!--  function renderPagination(pageData) {-->
<!--    const paginationUl = document.getElementById('pagination');-->
<!--    paginationUl.innerHTML = '';-->
<!--    if (pageData.totalPages <= 1) return;-->
<!--    if (!pageData.first) { paginationUl.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadDoctors(${currentPage - 1})">Previous</a></li>`; }-->
<!--    if (!pageData.last) { paginationUl.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadDoctors(${currentPage + 1})">Next</a></li>`; }-->
<!--  }-->

<!--  document.getElementById('filter-btn').addEventListener('click', () => loadDoctors(0));-->
<!--  document.addEventListener('DOMContentLoaded', () => loadDoctors(0));-->

<!--  document.getElementById('add-doctor-form').addEventListener('submit', function(e) {-->
<!--    e.preventDefault();-->
<!--    const doctorData = { fullName: document.getElementById('addFullName').value, specialization: document.getElementById('addSpecialization').value, contactNumber: document.getElementById('addContactNumber').value, email: document.getElementById('addEmail').value };-->
<!--    fetch('http://localhost:8080/api/doctors', {-->
<!--      method: 'POST',-->
<!--      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },-->
<!--      body: JSON.stringify(doctorData)-->
<!--    }).then(response => {-->
<!--      if (response.ok) { addModal.hide(); loadDoctors(0); }-->
<!--      else { alert('Error adding doctor.'); }-->
<!--    });-->
<!--  });-->

<!--  document.getElementById('edit-doctor-form').addEventListener('submit', function(e) {-->
<!--    e.preventDefault();-->
<!--    const doctorId = document.getElementById('editDoctorId').value;-->
<!--    const updatedData = { fullName: document.getElementById('editFullName').value, specialization: document.getElementById('editSpecialization').value, contactNumber: document.getElementById('editContactNumber').value, email: document.getElementById('editEmail').value };-->
<!--    fetch(`http://localhost:8080/api/doctors/${doctorId}`, {-->
<!--      method: 'PUT',-->
<!--      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },-->
<!--      body: JSON.stringify(updatedData)-->
<!--    }).then(response => {-->
<!--      if (response.ok) { editModal.hide(); loadDoctors(currentPage); }-->
<!--      else { alert('Error updating doctor.'); }-->
<!--    });-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Doctors</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="../js/auth.js" defer></script>
</head>
<body>
<div id="sidebar-placeholder"></div>

<div class="content">
  <h1>Manage Doctors</h1><hr>
  <div class="card bg-light mb-4">
    <div class="card-body"><div class="row g-3">
      <div class="col-md-5"><label>Search by Name</label><input type="text" id="nameFilter" class="form-control"></div>
      <div class="col-md-5"><label>Filter by Specialization</label><input type="text" id="specFilter" class="form-control"></div>
      <div class="col-md-2 d-flex align-items-end"><button id="filter-btn" class="btn btn-primary w-100">Search</button></div>
    </div></div>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <span id="result-summary"></span>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addDoctorModal"><i class="bi bi-plus-circle"></i> Add New Doctor</button>
  </div>

  <div class="card"><div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light"><tr><th>Name</th><th>Specialization</th><th>Status</th><th>Actions</th></tr></thead>
      <tbody id="doctor-table-body"></tbody>
    </table>
  </div></div>
  <nav class="mt-4"><ul id="pagination" class="pagination justify-content-center"></ul></nav>
</div>

<div class="modal fade" id="editDoctorModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Edit Doctor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <form id="edit-doctor-form">
        <input type="hidden" id="editDoctorId">
        <div class="mb-3"><label class="form-label">Full Name</label><input type="text" id="editFullName" class="form-control" required></div>
        <div class="mb-3"><label class="form-label">Specialization</label><input type="text" id="editSpecialization" class="form-control" required></div>
        <div class="mb-3"><label class="form-label">Contact Number</label><input type="text" id="editContactNumber" class="form-control"></div>
        <div class="mb-3"><label class="form-label">Email</label><input type="email" id="editEmail" class="form-control"></div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      <button type="submit" form="edit-doctor-form" class="btn btn-primary">Save Changes</button>
    </div>
  </div></div>
</div>

<div class="modal fade" id="addDoctorModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Add New Doctor</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <form id="add-doctor-form">
        <div class="mb-3"><label class="form-label">Full Name</label><input type="text" id="addFullName" class="form-control" required></div>
        <div class="mb-3"><label class="form-label">Specialization</label><input type="text" id="addSpecialization" class="form-control" required></div>
        <div class="mb-3"><label class="form-label">Contact Number</label><input type="text" id="addContactNumber" class="form-control"></div>
        <div class="mb-3"><label class="form-label">Email</label><input type="email" id="addEmail" class="form-control"></div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      <button type="submit" form="add-doctor-form" class="btn btn-primary">Save Doctor</button>
    </div>
  </div></div>


</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../js/layout-loader.js"></script>
<script>
  const token = localStorage.getItem('authToken');
  let currentPage = 0;
  const editModal = new bootstrap.Modal(document.getElementById('editDoctorModal'));
  const addModal = new bootstrap.Modal(document.getElementById('addDoctorModal'));

  function loadDoctors(page = 0) {
    currentPage = page;
    const name = document.getElementById('nameFilter').value;
    const spec = document.getElementById('specFilter').value;
    let url = `http://localhost:8080/api/doctors?page=${page}&size=5&sort=fullName,asc`;
    if (name) url += `&name=${name}`;
    if (spec) url += `&specialization=${spec}`;
    fetch(url, { headers: { 'Authorization': 'Bearer ' + token } }).then(res => res.json()).then(pageData => {
      renderTable(pageData.content);
      renderPagination(pageData);
      document.getElementById('result-summary').textContent = `Showing ${pageData.numberOfElements} of ${pageData.totalElements} results.`;
    });
  }

  function renderTable(doctors) {
    const tableBody = document.getElementById('doctor-table-body');
    tableBody.innerHTML = '';
    doctors.forEach(doc => {
      const actionButton = doc.status === 'ACTIVE'
              ? `<button class="btn btn-danger btn-sm action-btn" data-action="deactivate" data-id="${doc.id}">Deactivate</button>`
              : `<button class="btn btn-success btn-sm action-btn" data-action="activate" data-id="${doc.id}">Activate</button>`;
      tableBody.innerHTML += `<tr><td>${doc.fullName}</td><td>${doc.specialization}</td><td><span class="badge bg-${doc.status === 'ACTIVE' ? 'success' : 'secondary'}">${doc.status}</span></td><td><button class="btn btn-primary btn-sm edit-btn" data-id="${doc.id}" data-name="${doc.fullName}" data-spec="${doc.specialization}" data-contact="${doc.contactNumber || ''}" data-email="${doc.email || ''}">Edit</button> ${actionButton}</td></tr>`;
    });
    attachRowEventListeners();
  }

  function attachRowEventListeners() {
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.getElementById('editDoctorId').value = this.dataset.id;
        document.getElementById('editFullName').value = this.dataset.name;
        document.getElementById('editSpecialization').value = this.dataset.spec;
        document.getElementById('editContactNumber').value = this.dataset.contact;
        document.getElementById('editEmail').value = this.dataset.email;
        editModal.show();
      });
    });
    document.querySelectorAll('.action-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        updateDoctorStatus(this.dataset.id, this.dataset.action);
      });
    });
  }

  function updateDoctorStatus(id, action) {
    if (!confirm(`Are you sure you want to ${action} this doctor?`)) return;
    fetch(`http://localhost:8080/api/doctors/${id}/${action}`, {
      method: 'PATCH',
      headers: { 'Authorization': 'Bearer ' + token },
    }).then(response => {
      if (response.ok) { loadDoctors(currentPage); }
      else { alert('Error updating status.'); }
    });
  }

  function renderPagination(pageData) {
    const paginationUl = document.getElementById('pagination');
    paginationUl.innerHTML = '';
    if (pageData.totalPages <= 1) return;
    if (!pageData.first) { paginationUl.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadDoctors(${currentPage - 1})">Previous</a></li>`; }
    if (!pageData.last) { paginationUl.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="event.preventDefault(); loadDoctors(${currentPage + 1})">Next</a></li>`; }
  }

  document.getElementById('filter-btn').addEventListener('click', () => loadDoctors(0));
  document.addEventListener('DOMContentLoaded', () => loadDoctors(0));

  document.getElementById('add-doctor-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const doctorData = { fullName: document.getElementById('addFullName').value, specialization: document.getElementById('addSpecialization').value, contactNumber: document.getElementById('addContactNumber').value, email: document.getElementById('addEmail').value };
    fetch('http://localhost:8080/api/doctors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
      body: JSON.stringify(doctorData)
    }).then(response => {
      if (response.ok) { addModal.hide(); loadDoctors(0); }
      else { alert('Error adding doctor.'); }
    });
  });

  document.getElementById('edit-doctor-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const doctorId = document.getElementById('editDoctorId').value;
    const updatedData = { fullName: document.getElementById('editFullName').value, specialization: document.getElementById('editSpecialization').value, contactNumber: document.getElementById('editContactNumber').value, email: document.getElementById('editEmail').value };
    fetch(`http://localhost:8080/api/doctors/${doctorId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
      body: JSON.stringify(updatedData)
    }).then(response => {
      if (response.ok) { editModal.hide(); loadDoctors(currentPage); }
      else { alert('Error updating doctor.'); }
    });
  });
</script>
</body>
</html>